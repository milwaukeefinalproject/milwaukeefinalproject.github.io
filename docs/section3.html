<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Situation Analysis – </title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b7f410b14cd9c0453c6d1611169ae290.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"><img src="milwaukeelogo.png" style="height:40px;"></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./section1.html"> 
<span class="menu-text">Executive summary</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./section2.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./section3.html" aria-current="page"> 
<span class="menu-text">Situation Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./section4.html"> 
<span class="menu-text">Strategy Development</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./section5.html"> 
<span class="menu-text">Execution Plan</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#market-overview" id="toc-market-overview" class="nav-link active" data-scroll-target="#market-overview">Market overview</a></li>
  <li><a href="#competitor-snapshot" id="toc-competitor-snapshot" class="nav-link" data-scroll-target="#competitor-snapshot">Competitor snapshot</a></li>
  <li><a href="#consumer-insight" id="toc-consumer-insight" class="nav-link" data-scroll-target="#consumer-insight">Consumer insight</a></li>
  <li><a href="#key-barriers" id="toc-key-barriers" class="nav-link" data-scroll-target="#key-barriers">Key barriers</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Situation Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="market-overview" class="level2">
<h2 class="anchored" data-anchor-id="market-overview">Market overview</h2>
<p>Vietnam’s power tools market is growing steadily, driven by the country’s expanding construction, infrastructure, and manufacturing sectors. Segments such as HVAC, MEP, and civil works are becoming more professionalized, opening the door for advanced cordless technologies. Key highlights are presented below:</p>
<ul>
<li>The power tools market in Vietnam was valued at approximately USD 1.3 billion in 2023 (Ken Research).</li>
<li>The construction equipment segment reached 6.12 thousand units in 2023 and is projected to grow to 7.90 thousand units by 2029, with a CAGR of 4.35% (Arizton).</li>
<li>Vietnam’s broader construction market is expected to grow from USD 68.75 billion in 2024 to USD 110.42 billion by 2030, at a CAGR of 8.1% (Mordor Intelligence).</li>
<li>Demand for cordless power tools is gradually rising in urban areas due to increasing concerns over safety, mobility, and noise reduction, especially in HVAC and indoor applications.</li>
</ul>
<p><em>PESTEL Analysis:</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Factor</strong></th>
<th><strong>Relevance to Milwaukee Vietnam</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Political</strong></td>
<td>Regulations on tool safety, import tariffs, and workplace standards.</td>
</tr>
<tr class="even">
<td><strong>Economic</strong></td>
<td>Fuel cost vs.&nbsp;electricity, rising input costs, price-sensitive purchasing.</td>
</tr>
<tr class="odd">
<td><strong>Social</strong></td>
<td>Deep discounting mindset; legacy usage of gasoline/corded tools.</td>
</tr>
<tr class="even">
<td><strong>Technological</strong></td>
<td>Increased interest in lithium battery tools and smart diagnostics.</td>
</tr>
<tr class="odd">
<td><strong>Legal</strong></td>
<td>Safety compliance, warranty enforcement, and local standards.</td>
</tr>
<tr class="even">
<td><strong>Environmental</strong></td>
<td>Cordless tools offer cleaner, quieter operation; aligns with green trends.</td>
</tr>
</tbody>
</table>
<p><strong>Milwaukee Vietnam at a glance:</strong></p>
<ul>
<li>Entered the Vietnamese market in 2019.</li>
<li>Operates via 58 distributors and 124 sub-dealers nationwide.</li>
<li>Offers over 300 SKUs, primarily in cordless drills, wrenches, saws, and accessories.</li>
<li>Estimated annual revenue in Vietnam: 326 billion VND</li>
<li>Year-over-year revenue growth (2024 vs.&nbsp;2023): 32%</li>
<li>Key focus segments: HVAC contractors, electricians, infrastructure teams.</li>
<li>Current market stage: early penetration, with limited top-of-mind awareness outside of trade circles.</li>
</ul>
<p><strong>Key commercial insight:</strong></p>
<p>82% of total sales come from promotion-based activities, with full-price (“normal”) sales accounting for a small minority.</p>
<p>→ Reflects a strongly price-sensitive mindset, even among B2B/professional users.</p>
<p>→ Indicates a transactional purchase pattern: most customers wait for discounts rather than respond to brand equity.</p>
<p><em>Purchase Funnel (Current Customer Behavior)</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 41%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Stage</strong></th>
<th><strong>Customer Behavior</strong></th>
<th><strong>Milwaukee’s Current Challenge</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Awareness</strong></td>
<td>Low brand recognition in general population</td>
<td>Limited exposure outside B2B trade circuits; minimal brand campaigns.</td>
</tr>
<tr class="even">
<td><strong>Consideration</strong></td>
<td>Compares Milwaukee with Bosch, Makita, and cheaper alternatives</td>
<td>Benefits under-communicated; perceived as expensive.</td>
</tr>
<tr class="odd">
<td><strong>Purchase</strong></td>
<td>Only triggered during promotions</td>
<td>Struggles to generate full-price purchases; highly transactional behavior.</td>
</tr>
<tr class="even">
<td><strong>Post-purchase</strong></td>
<td>Low engagement unless re-promoted</td>
<td>Minimal loyalty-building; retention tied to continued discounting.</td>
</tr>
</tbody>
</table>
<p><strong>Milwaukee strategic direction (2024–2025):</strong></p>
<p>Due to these behavioral patterns, Milwaukee Vietnam is currently prioritizing conversion-based communication over brand-building.</p>
<p>→ Campaigns are focused on capturing market share through trial, in-store activation, and dealer support.</p>
<p>→ Performance KPIs (reach, engagement, brand love) are secondary to metrics such as purchase conversion, demo participation, and post-purchase retention.</p>
<p>→ Digital content (Facebook, Zalo) is mostly tactical, with limited investment in storytelling or emotional branding at this stage.</p>
<p><strong>Structural market barriers:</strong></p>
<ul>
<li>Corded and gasoline-powered tools continue to dominate among legacy users.</li>
<li>Cordless adoption is increasing in urban projects, but still viewed as expensive and “non-essential” by many field operators.</li>
<li>Short-term thinking and a “tool = cost” mindset reduce openness to long-term ROI narratives, especially for higher-priced SKUs.</li>
</ul>
<p><em>Ansoff Matrix</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Strategy Type</strong></th>
<th><strong>Application to Milwaukee Vietnam</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Market Penetration</strong></td>
<td>Focus on converting professional users (e.g., HVAC, electricians) via promotions, demos, and trials.</td>
</tr>
<tr class="even">
<td><strong>Market Development</strong></td>
<td>Expand reach to factories, industrial agencies, repair centers, and institutional contractors.</td>
</tr>
<tr class="odd">
<td><strong>Product Development</strong></td>
<td>Introduce localized kits, hand tool bundles, or accessory packs tailored to Vietnamese use cases.</td>
</tr>
<tr class="even">
<td><strong>Diversification</strong></td>
<td>Extend into adjacent categories such as hand tools, accessories, and light gardening equipment.</td>
</tr>
</tbody>
</table>
</section>
<section id="competitor-snapshot" class="level2">
<h2 class="anchored" data-anchor-id="competitor-snapshot">Competitor snapshot</h2>
<p>Milwaukee competes in the premium cordless tools segment, which is still relatively niche in Vietnam but gaining traction. Key competitors are presented as below:</p>
<ul>
<li>Bosch: Widely recognized and trusted in Vietnam, with strong distribution both offline and online. Offers a mix of corded and cordless tools.</li>
<li>Makita: Known for reliability and versatility, Makita maintains a solid presence across segments and is typically more affordable than Milwaukee.</li>
<li>Dewalt: A fellow American brand with similar positioning, though it has limited market visibility and reach.</li>
</ul>
<p>There are three major challenges Milwaukee is currently facing:</p>
<ul>
<li>Limited awareness despite global credibility.</li>
<li>Misconceptions about brand origin, often mistaken for a Chinese brand due to its acquisition by TTI (Hong Kong).</li>
<li>Lack of strong local presence in traditional tool retailers or e-commerce platforms.</li>
</ul>
<p><a href="#pm1">Perceptual map 1</a> reflects how Vietnamese professionals perceive major tool brands. Milwaukee stands out as highly durable but also the most expensive, which fits its positioning, but also creates resistance among price-sensitive users unfamiliar with its long-term value.</p>
<p>Bosch and Makita are seen as more affordable but less trusted for heavy-duty work. DeWalt sits in the middle, offering decent durability at a slightly lower cost.</p>
<p>The core insight: Milwaukee’s durability is respected, but not yet experienced by enough users. Many still compare on upfront price. This gap highlights the urgent need for trial-based campaigns, hands-on demos, and social proof to shift perception from “expensive” to “worth it.”</p>
<p><img src="image/pm1.png" id="pm1" class="img-fluid"></p>
<p><a href="#pm2">Perceptual map 2</a> explores the brand’s visibility in the market versus how much value users associate with it. The goal is to understand if a brand is well-known and whether that awareness leads to strong perceptions of quality, usefulness, or worth. Bosch is both widely known and seen as valuable — a result of its broad distribution and heavy local presence. Milwaukee sits in the low-awareness but high-value quadrant, indicating that those who know and use the brand appreciate its performance, but it remains under the radar for many. In contrast, Makita and DeWalt have good awareness, but their perceived value has eroded — possibly due to inconsistent performance or limited innovation. This signals a clear action path for Milwaukee: boost brand exposure while maintaining its product credibility. It doesn’t need to rework its tools — it needs more Vietnamese tradespeople to try them. Campaigns should focus on visibility, demos, and real stories to close the awareness gap without diluting value.</p>
<p><img src="image/pm2.png" id="pm2" class="img-fluid"></p>
<p><a href="#pm3">Perceptual map 3</a> assesses how actively distributors promote each brand (push) versus how much hesitation users show before purchasing (resistance). The aim is to uncover hidden barriers in the go-to-market pipeline — especially in a category where both retail influence and peer advice play major roles.</p>
<p>Bosch again leads with high retailer support and low user resistance. It’s easy to find, trusted, and often recommended by store staff. Milwaukee struggles on both fronts: retailers rarely push it, and users hesitate due to unfamiliarity, platform switching cost, or lack of first-hand reviews. DeWalt is pushed harder but still faces resistance, while Makita stays in a low-effort, low-friction zone — usually a default choice for low-stakes buyers.</p>
<p>Milwaukee needs a dual-front strategy here. On one side, empower retailers with training, incentive schemes, and better margin stories to drive recommendations. On the other, reduce user resistance through sampling, peer advocacy, and clearer onboarding — especially for those switching from corded or gasoline tools.</p>
<p><img src="image/pm3.png" id="pm3" class="img-fluid"></p>
</section>
<section id="consumer-insight" class="level2">
<h2 class="anchored" data-anchor-id="consumer-insight">Consumer insight</h2>
<p>Based on secondary research and early discussions with industry contacts, several behavioral patterns stand out among Vietnamese tool users:</p>
<ul>
<li>Price-first mentality: Most buyers, especially contractors and small businesses, evaluate tools based on upfront price rather than lifetime cost efficiency. For example, cordless tools are often perceived as “too expensive” without considering fuel savings, safety, or reduced maintenance.</li>
<li>Low brand loyalty: Except for long-time users of Bosch or Makita, many customers are willing to switch brands based on price promotions or peer suggestions.</li>
<li>Perception gap:
<ul>
<li>Milwaukee’s benefits (lightweight, safe, cordless) are not clearly understood.</li>
<li>Many believe Milwaukee is a Chinese or regional brand, which hurts its premium American positioning.</li>
</ul></li>
<li>Hands-on trial matters: Contractors and technicians trust what they can see and touch. In this segment, tool demonstrations often convert better than brochures or digital ads.</li>
</ul>
<div class="center-text">
<p><strong>Job-to-be-done</strong></p>
<p><em>“When I’m on-site and under time pressure, I want a tool that’s safe, reliable, and easy to carry, so I can finish the job quickly without worrying about breakdowns or hazards.”</em></p>
</div>
</section>
<section id="key-barriers" class="level2">
<h2 class="anchored" data-anchor-id="key-barriers">Key barriers</h2>
<p>Despite Milwaukee’s clear functional strengths, several barriers currently limit its ability to scale in Vietnam:</p>
<ul>
<li>Upfront pricing concerns: Battery-powered tools are seen as costly, and their long-term value (fuel savings, reduced hazards) isn’t well communicated.</li>
<li>Consumer habit inertia: Many users still prefer gasoline or corded tools, which they associate with power and reliability.</li>
<li>Lack of product education: Milwaukee’s M12™ and M18™ battery platforms, safety features, and long-term savings are not widely understood.</li>
<li>Brand origin confusion: Although an American brand, Milwaukee is often mistaken as “not really American” due to its acquisition by a Hong Kong-based company.</li>
<li>Distribution gaps: Limited availability in hardware stores, modern trade channels, and popular online marketplaces.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>